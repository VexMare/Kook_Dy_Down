# Kook抖音解析机器人项目计划

## 项目概述
基于Kook平台的抖音第三方解析机器人，支持解析抖音视频链接并在语音频道播放音频。采用卡片交互设计，提供直观的视频信息展示和播放控制。

## 核心设计理念
- `/dy` 命令仅获取视频信息，不播放
- 在KOOK中实时显示视频卡片，支持交互控制
- 提供完整的播放队列管理功能

## 核心功能设计

### 1. 抖音视频解析
- 支持抖音分享链接解析（短链接、长链接）
- 提取视频标题、作者、封面、音频地址等信息
- 支持多种抖音链接格式
- 使用第三方API：https://dy.chixiaotao.cn/docs

### 2. 视频卡片交互功能
- 实时显示视频信息卡片
- 包含视频封面、标题、作者、时长等信息
- 交互按钮：播放、暂停、停止、上一个、下一个、队列、音量、关闭
- 实时更新播放状态和进度

### 3. 音频播放功能
- 在Kook语音频道播放解析出的抖音音频
- 支持播放队列管理
- 播放控制（播放、暂停、停止、跳过）
- 集成FFmpeg进行音频处理

### 4. 智能命令系统
- `/dy [抖音链接]` - 仅解析视频信息，不播放
- `/dyplay [抖音链接]` - 解析并播放抖音视频音频
- `/dyadd [抖音链接]` - 添加音频到队列（不立即播放）
- `/dypause` - 暂停播放
- `/dyresume` - 继续播放
- `/dystop` - 停止播放
- `/dyskip` - 跳过当前音频
- `/dyqueue` - 查看播放队列
- `/dynow` - 显示当前播放信息
- `/dyclear` - 清空播放队列
- `/dysearch [关键词]` - 搜索抖音视频
- `/dyvolume [0-100]` - 调整音量
- `/dyhelp` - 显示所有可用命令
- `/dystatus` - 显示机器人状态
- `/dyversion` - 显示版本信息

## 技术架构

### 项目结构
```
douyin-bot/
├── config/          # 配置文件
│   ├── __init__.py
│   ├── settings.py  # 配置类
│   └── env.example  # 环境变量示例
├── src/            # 源代码
│   ├── __init__.py
│   ├── bot/        # 机器人核心
│   │   ├── __init__.py
│   │   ├── main.py # 机器人主程序
│   │   └── commands.py # 命令定义
│   ├── api/        # API接口
│   │   ├── __init__.py
│   │   ├── douyin_api.py # 抖音解析API
│   │   └── kook_api.py # Kook API封装
│   ├── utils/      # 工具函数
│   │   ├── __init__.py
│   │   ├── audio_utils.py # 音频处理工具
│   │   ├── link_parser.py # 链接解析工具
│   │   └── logger.py # 日志工具
│   └── handlers/   # 命令处理器
│       ├── __init__.py
│       ├── douyin_handler.py # 抖音相关命令处理
│       └── audio_handler.py # 音频播放处理
├── static/         # 静态资源
│   ├── css/
│   └── js/
├── templates/      # 模板文件
│   ├── index.html
│   └── dashboard.html
├── logs/           # 日志文件
├── tests/          # 测试文件
├── requirements.txt
├── README.md
└── run.py          # 启动文件
```

### 技术栈
- **Python 3.8+** - 主要开发语言
- **Kook.py** - Kook机器人SDK
- **Flask** - Web管理界面
- **Requests** - HTTP请求处理
- **FFmpeg** - 音频处理
- **python-dotenv** - 环境变量管理

### 配置管理
- 使用`.env`文件存储敏感信息
- 支持环境变量配置
- 配置文件分离，便于部署

## 特色功能

### 1. 智能链接识别
- 自动识别各种抖音链接格式
- 支持短链接和长链接
- 链接有效性验证

### 2. 音频质量优化
- 支持不同音质的音频提取
- 音频格式转换和优化
- 播放质量自适应

### 3. 播放队列管理
- 支持多首音频排队播放
- 队列状态实时显示
- 智能队列管理

### 4. 错误处理机制
- 完善的异常处理
- 用户友好的错误提示
- 详细的日志记录

### 5. Web管理界面
- 简单的Web控制台
- 实时状态监控
- 配置管理界面

## 安全考虑

### 1. Token保护
- 所有敏感信息通过环境变量管理
- 配置文件不包含敏感信息
- 支持多环境配置

### 2. API限流
- 实现请求频率限制
- 防止API滥用
- 智能重试机制

### 3. 错误日志
- 详细的日志记录
- 分级日志管理
- 便于调试和监控

## 开发计划

### 阶段1：基础框架搭建
1. 创建项目目录结构
2. 配置环境变量管理
3. 实现基础机器人框架
4. 集成Kook.py SDK
5. 创建数据模型和常量定义

### 阶段2：抖音解析功能
1. 集成第三方抖音解析API
2. 实现链接解析功能
3. 添加音频提取功能
4. 实现基础命令系统（/dy, /dyplay, /dyadd）

### 阶段3：音频播放功能
1. 集成FFmpeg音频处理
2. 实现语音频道播放
3. 添加播放控制功能
4. 实现播放队列管理服务

### 阶段4：卡片交互功能
1. 实现视频信息卡片显示
2. 添加交互按钮功能
3. 实现实时状态更新
4. 完善用户交互体验

### 阶段5：高级功能
1. 实现搜索功能
2. 添加音量控制
3. 完善错误处理
4. 性能优化和测试

## 功能列表总结

### 命令列表
- `/dy [链接]` - 获取视频信息
- `/dyplay [链接]` - 播放音频
- `/dyadd [链接]` - 添加到队列
- `/dypause` - 暂停
- `/dyresume` - 继续
- `/dystop` - 停止
- `/dyskip` - 跳过
- `/dyqueue` - 查看队列
- `/dynow` - 当前播放
- `/dyclear` - 清空队列
- `/dysearch [关键词]` - 搜索
- `/dyvolume [0-100]` - 音量控制
- `/dyhelp` - 帮助
- `/dystatus` - 状态
- `/dyversion` - 版本

### 交互按钮
- 播放控制：播放、暂停、停止、上一个、下一个
- 功能按钮：队列、音量、关闭

## 参考项目
- 现有音乐机器人项目（windows文件夹）
- Kook官方API文档（api-docs文件夹）
- 第三方抖音解析API文档

## 注意事项
- 遵循Kook平台使用规范
- 遵守第三方API使用条款
- 确保音频版权合规
- 实现合理的请求频率限制
